!function(e){function a(){e(".viewloglink").click(function(){var a=e(this).attr("href");return e("#backup_name").val(a),e("#viewlog").submit(),!1})}function t(){e(".downloadbackuplink").bind("click",function(){var a=e(this).attr("href");return e("#backup_file").val(a),e(this).append('<i class="fa fa-check"></i>'),e(this).css({color:"green"}),e("#download_backup").submit(),!1})}function i(a,i){var o=({action:h("backup_zip_filelist"),job_id:a},i.replace(/[^A-Za-z0-9\-]/g,"")),s=0,c="",l='<div id="'+o+'">            <h2>WP BackItUp Backup Set: &nbsp;<em>'+i+'</em></h2>            <div class="wpbiu-notes">            <textarea class="backupnotes" id="wpbiu-note-box" placeholder="add notes here"></textarea>            <button id="wpbiu-note-btn" class="button-primary">Save</button><span id="wpbiu-note-response">Note Saved!</span></div>            <p>Below are the archive files included in this backup set. Click the link to download.</p>            <table class="widefat" id="datatable">              <tbody>';e.ajax({url:ajaxurl,type:"POST",data:{action:h("backup_zip_filelist"),job_id:a},dataType:"json"}).done(function(i){i.data?(e.each(i.data,function(){var a=e(this)[0].name.split(/[\/]+/).pop(),t=e(this)[0].size,i=e(this)[0].file_exists;if(console.log(a,t),a.indexOf("-backupset-")>-1)c='<p><a class="downloadbackuplink" href="'+a+'"><i class="fa fa-cloud-download fa-3x"></i> <strong>Download a single zip file that contains all these files.</strong></a>                                          <br><em>* Please note that this is a '+t+" file which may timeout on some hosts.</em></p>";else{s++;var n="";s%2!=0&&(n="alternate"),l+='<tr class="'+n+'" id="row'+s+'">',l+=i?'<td><a class="downloadbackuplink" href="'+a+'">'+a+"</a></td>":"<td>"+a+"</td>",l+="<td>"+t+"</td>                         </tr>"}}),l+=c+"</tbody></table></div>",e("#TB_ajaxContent").html(l),t(),e.ajax({url:ajaxurl,type:"post",data:{action:h("backup_get_note"),job_id:a},success:function(a){e("#wpbiu-note-box").val(a.data)}}),e("#wpbiu-note-btn").click(function(){var t=e("#wpbiu-note-box").val();e.ajax({url:ajaxurl,type:"POST",data:{action:h("backup_add_note"),job_id:a,note:t},dataType:"json"}).success(function(a){e("#wpbiu-note-response").fadeIn()})}),e("#wpbiu-note-box").focus(function(){e("#wpbiu-note-response").hide()})):n(i,null,null)}).fail(function(e,a,t){n(e,a,t)})}function n(e,a,t){var i="Error-Invalid response from server:  ";a&&(i+=a+"\n"),t&&(i+=t+"\n"),i+="\nResponse: \n\n"+JSON.stringify(e),alert(i)}function o(){var a={action:h("restore_status_reader"),job_id:v};e.post(ajaxurl,a,function(a){var t=e(a);t.each(function(){var a="."+e(this).attr("class"),t="."+e(this).attr("class")+"-icon";0==e(this).html()&&(e(a).find(".status").hide(),e(a).find(".status-icon").hide()),1==e(this).html()&&(e(t).css("visibility","visible"),e(a).find(".status").fadeOut(200),e(a).find(".status-icon").fadeIn(1500)),2==e(this).html()&&(e(a).find(".status-icon").fadeOut(200),e(a).find(".status").fadeIn(1500)),e(this).html()==-1&&(e(a).find(".status-icon").fadeOut(200),e(a).find(".fail").fadeIn(1500),e(a).find(".isa_error").fadeIn(1500),clearInterval(window.intervalDefine)),e(this).html()==-2&&e(a).find(".isa_warning").fadeIn(1500),99==e(this).html()&&(e(a).find(".isa_success").fadeIn(1500),clearInterval(window.intervalDefine))})})}function s(){var a={action:h("backup_status_reader"),job_id:v};e.post(ajaxurl,a,function(a){if(x)return clearInterval(window.intervalDefine),e(".status-icon").fadeOut(200),e("#backup-button").removeAttr("disabled"),e("#cancel-button").fadeOut(200),e(".backup-cancelled").fadeIn(200),!1;var t=e(a);t.each(function(){var a="."+e(this).attr("class"),t="."+e(this).attr("class")+"-icon";0==e(this).html()&&(e(a).find(".status").hide(),e(a).find(".status-icon").hide()),1==e(this).html()&&(e(t).css("visibility","visible"),e(a).find(".status").fadeOut(200),e(a).find(".status-icon").fadeIn(1500)),2==e(this).html()&&(e(a).find(".status-icon").fadeOut(200),e(a).find(".status").fadeIn(1500)),e(this).html()==-1&&(e(a).find(".status-icon").fadeOut(200),e(a).find(".fail").fadeIn(1500),clearInterval(window.intervalDefine),c()),e(this).html()==-2&&(e(a).find(".status-icon").fadeOut(200),e(a).find(".wpbackitup-warning").fadeIn(1500)),99==e(this).html()&&(e(a).find(".status-icon").fadeOut(200),e(a).find(".status").fadeIn(1500),clearInterval(window.intervalDefine),c())})})}function c(){var a=e.ajax({url:ajaxurl,type:"POST",data:{action:h("backup_response_reader")},dataType:"json"});a.always(function(a,t,i){if(console.log("Backup Response:"+JSON.stringify(a)),"undefined"!=typeof a.backupStatus&&"undefined"!=typeof a.backupMessage){if(console.log("JSON Backup Status:"+a.backupStatus),console.log("JSON Backup Message:"+a.backupMessage),y)return;switch(y=!0,a.backupStatus){case"success":if(console.log("JSON success response received."),e(".status-icon").fadeOut(200),e("#backup-button").removeAttr("disabled"),e("#cancel-button").addClass("cancel-hidden"),e(".isa_success").show,e(".backup-success").fadeIn(1500),f(a),"undefined"!=typeof a.backupWarnings){var n=e(".backup-warning"),o=a.backupWarnings;o.forEach(function(e){var a=e.warningMessage;n.append('<li class="isa_warning">'+wpbackitup_local.warning+": "+a+"</li>")}),n.fadeIn(1500)}break;case"error":console.log("JSON error response received.");var s=wpbackitup_local.unexpected_err;"undefined"!=typeof a.backupMessage&&(s=a.backupMessage);var c=wpbackitup_local.error+": &nbsp;"+s,l=e(".backup-error");l.html(c),l.addClass("isa_error"),l.fadeIn(1500),e(".status-icon").fadeOut(200),e("#backup-button").removeAttr("disabled"),e("#cancel-button").addClass("cancel-hidden");break;default:console.log("Unexpected JSON response status received.");var s=wpbackitup_local.unexpected_err2;"undefined"!=typeof a.backupMessage&&(s=a.backupMessage);var c=wpbackitup_local.error+"(JS998) : &nbsp;"+s,r=e(".backup-error");r.html(c),r.addClass("isa_error"),r.fadeIn(1500),e(".status-icon").fadeOut(200),e("#backup-button").removeAttr("disabled"),e("#cancel-button").addClass("cancel-hidden")}}else{console.log("NON JSON response received."),console.log("Backup Response:"+i),c=wpbackitup_local.unexpected_err3+": &nbsp;",c+="</br>"+wpbackitup_local.response+": &nbsp;"+JSON.stringify(a),c+="</br>"+wpbackitup_local.status+": &nbsp;"+t,c+="</br>"+wpbackitup_local.error+": &nbsp;"+JSON.stringify(i),e(".backup-status").hide();var r=e(".backup-error");r.html(c),r.addClass("isa_error"),r.show(),e(".status-icon").fadeOut(200)}})}function l(){e(".backup-icon").css("visibility","visible"),e(".backup-icon").show(),e(".backup-success").hide(),e(".default-status").hide(),e(".backup-error").hide(),e(".backup-cancelled").hide(),e("ul.backup-status").children().children().hide(),e(".backup-errors").children().children().hide(),e(".backup-success").children().children().hide(),e(".backup-status").show(),y=!1,window.intervalDefine=setInterval(s,5e3)}function r(){e(".backup-icon").css("visibility","visible"),e(".backup-icon").show(),e(".backup-status").show(),y=!1,clearInterval(window.intervalDefine),window.intervalDefine=setInterval(s,5e3)}function u(){e(".restore-icon").css("visibility","visible"),e(".default-status, .upload-status").hide(),e("ul.restore-status").children().children().hide(),e(".restore-errors").children().children().hide(),e(".restore-success").children().children().hide(),e(".restore-status, .restore-errors, .restore-success").show(),e(".preparing-icon").css("visibility","visible"),e(".preparing").find(".status-icon").fadeIn(1500),window.intervalDefine=setInterval(o,5e3)}function d(a){var t=new plupload.Uploader(a);t.init(),t.bind("FilesAdded",function(a,t){plupload.each(t,function(a){e("#filelist").append('<div id="media-item-'+a.id+'" class="media-item child-of-0"><img class="pinkynail" alt="" src="'+site_url+'/wp-includes/images/media/archive.png"><div class="filename new" id="'+a.id+'">'+a.name+" (<span>"+plupload.formatSize(0)+"</span> of "+plupload.formatSize(a.size)+') <div class="progress" style="width: 0%;"></div></div></div>')}),a.refresh(),a.start()}),t.bind("UploadProgress",function(a,t){e("#"+t.id+" .progress").width(.15*t.percent+"%"),e("#"+t.id+" span").html(plupload.formatSize(parseInt(t.size*t.percent/100)))}),t.bind(" ChunkUploaded",function(e,a,t){console.log("Chunk Uploaded:"),console.log(t),p(t,e,a)&&console.log("chunk error")}),t.bind("Error",function(a,t){console.log("PlUpload Error:"),console.log(t);var i="error-item-"+t.file.id;e("#"+i).length||e("#filelist").append('<div class="error-div error" id="'+i+'" ><strong>'+t.file.name+" has failed to upload due to error:&nbsp;</strong> <span>"+t.message+"</span> </div>")}),t.bind("FileUploaded",function(a,t,i){console.log("File Uploaded"),console.log(i),p(i,a,t)?console.log("uploaded error"):(console.log("uploaded success"),e("#"+t.id+" .progress").css("background-color","green"),e("#import-uploads").show())})}function p(e,a,t){if("200"!=e.status)return alert("Unknown server response status: "+e.code),console.log(e),b(a,t,999,e.response),!0;try{return response_json=jQuery.parseJSON(e.response),!!response_json.error&&(b(a,t,100,response_json.error),!0)}catch(i){return console.log("Unexpected JSON Error"+i),b(a,t,998,e.response),!0}}function b(a,t,i,n){t.status=plupload.FAILED,a.trigger("Error",{code:i,message:n,file:t}),e("#media-item-"+t.id).hide()}function f(i){console.log(i);var n;n='class="success-grid"',e("#datatable tr").first().hasClass("alternate")||(n='class="alternate success-grid"');var o=e("#datatable tr:last")[0].id.replace("row","");if(o++,"undefined"!=typeof i){var s='<td data-th="Type" class="word-capitalize">'+i.backupRuntype+'</td>\n<td data-th="Date">'+i.backupDate+"</td>\n";s+='<td data-th="Duration">'+i.backupDuration+"</td>\n",i.backupMessage&&(s+='<td data-th="Status">'+i.backupMessage+"</td>\n");var c=i.backupName,l=c.replace(/[^A-Za-z0-9\-]/g,""),r=c.lastIndexOf("_"),u=c.substring(r+1),d="<tr "+n+' id="row'+o+'">\n          <td data-th="Backup"><a href="#TB_inline?width=600&height=550&inlineId='+l+'" class="thickbox" title="Download Backup" name="'+i.backupName+'" data-jobid="'+u+'"><i class="fa fa-download"></i> '+i.backupName+"</a></td>\n";d+=s,d+="<td>&nbsp;</td>",d+="</tr>",e("#nofiles")&&e("#nofiles").remove();e("#datatable tr").length;e("#datatable").prepend(d),e("#datatable tr:first").hide().show("slow"),a(),t()}}function h(e){return g+"_"+e}function _(){notification_bar=e("#wp-backitup-notification-parent"),notification_bar.fadeOut("slow")}function k(a){notification_bar_message=e("#wp-backitup-notification-message"),notification_bar_message.html("<p>"+a+"</p>"),notification_bar=e("#wp-backitup-notification-parent"),notification_bar.toggleClass("error",!1),notification_bar.toggleClass("updated",!0),notification_bar.show(),e("html, body").animate({scrollTop:0},"slow")}function w(a){notification_bar_message=e("#wp-backitup-notification-message"),notification_bar_message.html("<p>"+a+"</p>"),notification_bar=e("#wp-backitup-notification-parent"),notification_bar.toggleClass("updated",!1),notification_bar.toggleClass("error",!0),notification_bar.show(),e("html, body").animate({scrollTop:0},"slow")}var g="wp-backitup",v=0;a(),t();try{"undefined"!=typeof wpbackitup_plupload_config&&d(wpbackitup_plupload_config)}catch(m){console.log(m)}e("#scheduled-backups-accordian").click(function(){scheduled_backups=e("#scheduled-backups"),scheduled_backups_button=e("#scheduled-backups-accordian"),e(this).is(".fa-angle-double-down")?(scheduled_backups.fadeIn("slow"),scheduled_backups_button.toggleClass("fa-angle-double-down",!1),scheduled_backups_button.toggleClass("fa-angle-double-up",!0)):(scheduled_backups_button.toggleClass("fa-angle-double-down",!0),scheduled_backups_button.toggleClass("fa-angle-double-up",!1),scheduled_backups.fadeOut("slow"))}),e("#upload-backups-accordian").click(function(){upload_backups=e("#wpbackitup-plupload-modal"),upload_backups_button=e("#upload-backups-accordian"),e(this).is(".fa-angle-double-down")?(upload_backups.fadeIn("slow"),upload_backups_button.toggleClass("fa-angle-double-down",!1),upload_backups_button.toggleClass("fa-angle-double-up",!0)):(upload_backups_button.toggleClass("fa-angle-double-down",!0),upload_backups_button.toggleClass("fa-angle-double-up",!1),upload_backups.fadeOut("slow"))}),e("#wpbackitup-zip").bind("change",function(){var a=this.files[0].size,t=e("#maxfilesize").val();"undefined"!=a&&"undefined"!=t&&""!=a&&""!=t&&a>t&&(alert(wpbackitup_local.upload_file_size_exceed),e("#wpbackitup-zip").val(""))}),e("#wpbackitup_delete_all").change(function(){cb=e(this),cb.val(cb.prop("checked")===!0?1:0)}),e("#wpbackitup_rversion_compare").change(function(){cb=e(this),cb.val(cb.prop("checked")===!0?1:0)}),e("#wpbackitup_single_file_backupset").change(function(){cb=e(this),cb.val(cb.prop("checked")===!0?1:0)}),e("#wpbackitup_remove_supporting_zip_files").change(function(){cb=e(this),cb.val(cb.prop("checked")===!0?1:0)}),e("#wpbackitup_remove_supporting_zip_files").change(function(){cb=e(this),cb.val(cb.prop("checked")===!0?1:0)}),e("#wpbackitup_single_file_db").change(function(){cb=e(this),cb.val(cb.prop("checked")===!0?1:0)}),e("#wpbackitup_backup_plugins_filter").tagit(),e("#wpbackitup_backup_themes_filter").tagit(),e("#wpbackitup_backup_uploads_filter").tagit(),e("#wpbackitup_backup_others_filter").tagit(),e("#wpbackitup_backup_dbtables_filterable_list , #wpbackitup_backup_dbtables_filtered_list").sortable({connectWith:".wpbackitup_connectedSortable"}).disableSelection(),e('#wpbackitup-settings input[type="submit"]').click(function(a){var t=Array();e("#wpbackitup_backup_dbtables_filtered_list li").each(function(a){t.push(e(this).text())}),e("#wpbackitup_backup_dbtables_filter_list").val(t.join(", "))}),e("#import-uploads").click(function(){setTimeout(function(){window.location.reload()},100)}),e(document.body).on("click",".thickbox",function(){if(!e(this).parents(".wpbiu-restore-item").length){var a=e(this).data("jobid");console.log(a);var t=this.name;i(a,t)}}),e(document.body).on("click",".thickbox",function(){var a=e(this).data("jobid"),t=e(this).attr("name");if(e(this).parents(".wpbiu-restore-item").length){var i="<h2>WP BackItUp Backup Set: &nbsp;<em>"+t+'</em></h2>              <div class="wpbiu-notes">                 <textarea class="backupnotes" id="wpbiu-restore-note-box" placeholder="add notes here"></textarea>                 <button id="wpbiu-restore-note-btn" class="button-primary">Save</button>                 <span id="wpbiu-restore-note-response">Note Saved!</span>               </div>';e("#wpbiu-restore-note").html(i),e("#wpbiu-restore-note-response").hide(),e.ajax({url:ajaxurl,type:"post",data:{action:h("backup_get_note"),job_id:a},success:function(a){e("#wpbiu-restore-note-box").val(a.data)}}),e("#wpbiu-restore-note-btn").click(function(){var t=e("#wpbiu-restore-note-box").val();e.ajax({url:ajaxurl,type:"POST",data:{action:h("backup_add_note"),job_id:a,note:t},dataType:"json"}).success(function(a){e("#wpbiu-restore-note-response").fadeIn()})})}e("#wpbiu-restore-note-box").focus(function(){e("#wpbiu-restore-note-response").hide()})});var y=!1;e("#wp-backitup-notification-widget-close").click(function(){notification_bar=e("#wp-backitup-notification-widget"),notification_bar.fadeOut("slow");var a=e.ajax({url:ajaxurl,type:"POST",data:{action:h("delete_transient")},dataType:"json"});a.always(function(a,t,i){a!==!1&&(notification_bar.removeClass(),notification_bar.addClass("notice"),notification_bar.addClass("notice-"+a.message_type),e("#wp-backitup-notification-widget-message p").html(a.message),notification_bar.hide().fadeIn("slow"))})}),e("#wp-backitup-notification-close").click(function(){_()}),e("#wp-backitup-save_schedule_form").submit(function(){var a=new FormData;a.append("action",h("update-schedule")),a.append("_wpnonce",e("#wp-backitup_nonce-update-schedule").val()),a.append("_wp_http_referer",e("[name='_wp_http_referer']").val());var t=[];return e.each(e("input[name='dow']:checked"),function(){t.push(e(this).val())}),a.append("days_selected",t),jQuery.ajax({url:ajaxurl,type:"POST",cache:!1,contentType:!1,processData:!1,dataType:"json",data:a,success:function(e,a,t){switch(response=e.message,console.log("Success:"+response),response){case"success":k(wpbackitup_local.scheduled_saved);break;case"error":w(wpbackitup_local.scheduled_not_saved)}},error:function(e,a,t){console.log("Error."+a+":"+t)},complete:function(e,a){console.log("Complete")}}),!1});var j=null;e(".backup-button").click(function(a){a.preventDefault(),x=!1,e("#backup-button").attr("disabled","disabled"),e("#cancel-button").removeClass("cancel-hidden"),e("#cancel-button").removeAttr("disabled"),e("#cancel-button").fadeIn(200),j=e.ajax({url:ajaxurl,type:"POST",data:{action:h("backup")},cache:!1,dataType:"json",beforeSend:function(e,a){console.log("BeforeSend:Nothing to report."),l()}}),j.always(function(e,a,t){console.log("Backup Button Click - Always"),console.log(e.message),"undefined"!=typeof e.job_id?(v=e.job_id,console.log("Job_Id:"+e.job_id)):console.log("No Job Id found:"+e)})});var x=!1;e(".cancel-button").click(function(a){a.preventDefault(),e("#cancel-button").attr("disabled","disabled"),null!=j&&(j.abort(),j=null),j=e.ajax({url:ajaxurl,type:"POST",data:{action:h("cancel_backup"),job_id:v},cache:!1,dataType:"json",beforeSend:function(e,a){console.log("BeforeSend:Nothing to report."),r()}}),j.always(function(e,a,t){console.log("Cancel Button Click - Always"),console.log(e),"undefined"!=typeof e.success&&1==e.success?console.log("Job Cancelled successfully"):console.log("Job was not cancelled successfully"),x=!0})}),e("#datatable").on("click","a.restoreRow",function(a){if(a.preventDefault(),confirm(wpbackitup_local.confirm_restore)){var t=this.title;this.id.replace("restoreRow","row");userid=e("input[name=user_id]").val();var i=e.ajax({url:ajaxurl,type:"post",data:{action:h("restore"),selected_file:t,user_id:userid},cache:!1,dataType:"json",beforeSend:function(){console.log("BeforeSend:Nothing to report."),u()}});i.always(function(e,a,t){"undefined"!=typeof e.job_id?(v=e.job_id,console.log("Job_Id:"+e.job_id)):console.log("No Job Id found:"+e)})}}),e("#datatable").on("click","a.deleteRow",function(a){if(a.preventDefault(),confirm(wpbackitup_local.sure)){var t=this.title,i=e(this).data("id"),n=this.id.replace("deleteRow","row");e.ajax({url:ajaxurl,type:"post",data:{action:h("delete_file"),filed:t,post_id:i},success:function(a){var t=a.search("deleted");0==t?e("#"+n).remove():alert(wpbackitup_local.file_not_del)}})}})}(jQuery),function(e){var a={isEmail:function(e){var a=/^([a-zA-Z0-9_.+-])+\@(([a-zA-Z0-9-])+\.)+([a-zA-Z0-9]{2,4})+$/;return a.test(e)},tagItEmailErrorMsg:function(a,t,i,n){var o=!0;a.each(function(a){var t=e(this).text().slice(0,-1);o=2==n&&!i(t)||o&&i(t)}),o?t.hide():t.show()}};e("#wpbiu-notification-emails").tagit({afterTagAdded:function(t,i){e(".wpbiu-transient-msg").hide();var n=e("#wpbiu-invalid-email");a.tagItEmailErrorMsg(i.tag,n,a.isEmail,1)},afterTagRemoved:function(t,i){e(".wpbiu-transient-msg").hide();var n=e("#wpbiu-invalid-email");a.tagItEmailErrorMsg(i.tag,n,a.isEmail,2)}}),e(".logs_backup").click(function(){var a=e(this).attr("href");return e("#backup_file").val(a),e("#download_logs").val(),e("#download_backup").submit(),!1})}(jQuery);